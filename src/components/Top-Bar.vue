<template>
  <oc-navbar id="oc-topbar" tag="header" class="oc-topbar uk-navbar">
    <oc-navbar-item position="left">
      <oc-button
        v-if="hasAppNavigation"
        key="extension-navigation-button"
        icon="menu"
        variation="primary"
        class="oc-topbar-menu-burger uk-height-1-1"
        :aria-label="$gettext('Menu')"
        @click="toggleAppNavigationVisibility"
        ref="menubutton"
      >
        <span class="oc-topbar-menu-burger-label" v-translate>Menu</span>
      </oc-button>
      <span v-else key="extension-title" class="topbar-current-extension-title uk-margin-left" v-text="currentExtensionName" />
    </oc-navbar-item>
    <oc-navbar-item position="center">
      <router-link to="/" class="oc-topbar-icon">ownCloud X</router-link>
    </oc-navbar-item>
    <oc-navbar-item position="right" v-if="!isPublicPage">
      <notifications v-if="activeNotifications.length" />
      <applications-menu :applicationsList="$_applicationsList"/>
      <user-menu :user-id="userId" :user-display-name="userDisplayName" />
    </oc-navbar-item>
  </oc-navbar>
</template>

<script>
import { mapGetters } from 'vuex'
import ApplicationsMenu from './ApplicationsMenu.vue'
import UserMenu from './UserMenu.vue'
import Notifications from './Notifications.vue'

export default {
  components: {
    Notifications,
    ApplicationsMenu,
    UserMenu
  },
  props: {
    userId: {
      type: String,
      required: false,
      default: null
    },
    userDisplayName: {
      type: String,
      required: false,
      default: null
    },
    applicationsList: {
      type: Array,
      required: false,
      default: () => []
    },
    hasAppNavigation: {
      type: Boolean,
      required: false,
      default: false
    },
    activeNotifications: {
      type: [Array, Boolean],
      required: false,
      default: () => []
    }
  },
  computed: {
    ...mapGetters(['apps']),

    isPublicPage () {
      return !this.userId
    },

    currentExtensionName () {
      if (!this.apps[this.currentExtension]) {
        return null
      }
      return this.$gettext(this.apps[this.currentExtension].name)
    },

    $_applicationsList () {
      return this.applicationsList
    }
  },
  methods: {
    toggleAppNavigationVisibility () {
      this.$emit('toggleAppNavigationVisibility')
    }
  }
}
</script>

TODO: Move to ODS and enable theming
<style scoped>
.topbar-current-extension-title {
  color: white
}
</style>
